{% assign services = '' %}
{% for service in site.shipcloud.supported_services %}
  {% capture new_service %}"{{service}}"|{% endcapture %}
  {% assign services = services | append: new_service %}
{% endfor %}
{% assign services = services | split: '|' %}

{% assign all_additional_services = '' %}
{% assign carriers = site.data.carriers %}
{% for carrier in carriers %}
  {% for interface in carrier[1].interfaces %}
    {% if interface[1].implementations.shipcloud.additional_services.size > 0 %}
      {% for additional_service in interface[1].implementations.shipcloud.additional_services %}
        {% capture new_additional_service %}"{{additional_service['key']}}"|{% endcapture %}
        {% assign all_additional_services = all_additional_services | append: new_additional_service %}
      {% endfor %}
    {% endif %}
  {% endfor %}
{% endfor %}
{% assign all_additional_services = all_additional_services | split: '|' %}

{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "description": "key for referencing the carrier within shipcloud"
    },
    "display_name": {
      "type": "string",
      "description": "name of the carrier you can use to display it in your application"
    },
    "services": {
      "type": "array",
      "items": [
        {
          "type": "string",
          "description": "key for referencing the service within shipcloud",
          "enum": [{{ services | join: ', ' }}],
          "default": "standard"
        }
      ]
    },
    "package_types": {
      "type": "array",
      "items": [
        {
          "type": "string",
          "description": "key for referencing the package type within shipcloud",
          "enum": ["parcel", "bulk", "letter", "books", "parcel_letter"],
          "default": "parcel"
        }
      ]
    },
    "additional_services": {
      "type": "array",
      "items": [
        {
          "type": "string",
          "description": "key for referencing the package type within shipcloud",
          "enum": {{ all_additional_services | uniq | join: ', ' }}
        }
      ]
    }
  },
  "required": [
    "name",
    "display_name",
    "services",
    "package_types",
    "additional_services"
  ],
  "additionalProperties": false
}
